<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>PTE – Arrange Missing Paragraphs (Part 2) | Modern English Australia</title>

<style>
:root{
  /* Page */
  --bg:#eef2f6;          /* very light blue-grey */
  --card:#ffffff;        /* white cards */
  --ink:#1e2933;         /* dark blue-grey text */
  --muted:#6b7280;       /* neutral grey */

  /* Accent */
  --accent:#4b4d4f;      /* PTE-like blue */
  --accent-soft:#e7f0ff; /* soft highlight */

  /* Lines & feedback */
  --line:#d9e0ea;
  --ok:#1db954;
  --err:#e74c3c;

  --radius:14px;
  --shadow:0 8px 24px rgba(30,41,59,.08);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--ink);
  min-height:100vh;
  line-height:1.65;
  display:flex;
  flex-direction:column;
}

/* ===== Header (match Part 1) ===== */
header{
  background:#0f2a44; /* dark blue bar */
  color:#ffffff;
  text-align:center;
  padding:1.25rem 1rem;
  position:relative;
}
header h1{margin:0;font-size:1.25rem;font-weight:800;}
header span{
  background:none;      /* remove pill */
  color:#ffffff;        /* white */
  padding:0;
  border-radius:0;
  margin-right:6px;
  font-weight:900;
}
#timer{
  position:absolute;
  right:1rem;
  top:1rem;
  background:var(--accent);
  color:#ffffff;
  padding:.4rem .75rem;
  border-radius:8px;
  font-weight:900;
}

/* ===== Main ===== */
main{
  flex:1;
  width:min(1000px,100%);
  margin:1.75rem auto;
  padding:0 1rem;
}
.instructions{
  text-align:center;
  color:var(--muted);
  margin-bottom:1.2rem;
  background:var(--accent-soft);
  padding:.75rem 1rem;
  border-radius:10px;
}

/* ===== Columns ===== */
.columns{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:1rem;
}
@media(max-width:900px){
  .columns{grid-template-columns:1fr;}
}

/* ===== Card columns ===== */
.column{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:1rem;
  border:1px solid var(--line);
  max-height:640px;
  overflow:auto;
}
.column h2{
  text-align:center;
  color:var(--accent);
  font-size:1.1rem;
  margin:0 0 .75rem;
  position:sticky;
  top:0;
  background:var(--card);
  padding:.25rem 0 .6rem;
  border-bottom:1px solid var(--line);
  z-index:1;
}

/* ===== Blocks ===== */
.paragraph{
  background:#f4f7fb;
  border:1px solid var(--line);
  border-radius:10px;
  padding:1rem;
  margin-bottom:.9rem;
  white-space:pre-line;
  cursor:pointer;
  transition:transform .12s ease, background .2s ease;
}
.paragraph:hover{
  background:var(--accent-soft);
  transform:scale(1.01);
}

.blank{
  background:#f8fafc;
  border:2px dashed rgba(30,107,214,.55);
  border-radius:10px;
  padding:1rem;
  margin-bottom:.9rem;
  min-height:86px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  color:#7b8794;
  font-style:italic;
  position:relative;
}

/* When filled */
.blank.filled{
  border-style:solid;
  color:var(--ink);
  font-style:normal;
  justify-content:flex-start;
  text-align:left;
}

/* remove button on filled blanks */
.blank .remove{
  position:absolute;
  top:10px;
  right:10px;
  border:1px solid var(--line);
  background:#ffffff;
  color:var(--accent);
  border-radius:999px;
  padding:.25rem .6rem;
  font-weight:900;
  cursor:pointer;
}
.blank .remove:hover{
  background:var(--accent);
  color:#ffffff;
}

/* ===== Controls ===== */
.controls{
  display:flex;
  gap:.75rem;
  justify-content:center;
  flex-wrap:wrap;
  margin:1.1rem 0 1.1rem;
}
.btn{
  padding:.85rem 1.35rem;
  border-radius:12px;
  border:1px solid transparent;
  font-weight:900;
  cursor:pointer;
  background:var(--accent);
  color:#ffffff;
}
.btn.secondary{
  background:#ffffff;
  color:var(--accent);
  border-color:var(--accent);
}
.btn:disabled{
  opacity:.55;
  cursor:not-allowed;
}

/* ===== Feedback ===== */
.feedback{
  text-align:center;
  font-weight:900;
  margin-top:.9rem;
}
.correct{color:var(--ok);}
.incorrect{color:var(--err);}

/* ===== Bottom Navigation (match Part 1) ===== */
.nav-links{
  display:flex;
  justify-content:center;
  gap:.75rem;
  flex-wrap:wrap;
  margin:1.8rem 0 .5rem;
}
.nav-links a{
  text-decoration:none;
  font-weight:900;
  padding:.75rem 1.4rem;
  border-radius:10px;
  background:#ffffff;
  color:var(--accent);
  border:1px solid var(--line);
  transition:all .2s ease;
}
.nav-links a:hover{
  background:var(--accent);
  color:#ffffff;
}

/* ===== Footer ===== */
footer{
  background:#f4f7fb;
  color:var(--muted);
  text-align:center;
  padding:1rem;
  border-top:1px solid var(--line);
}
footer span{color:var(--accent);font-weight:900;}
</style>
</head>

<body>

<header>
  <h1><span>Modern English AU</span> PTE – Arrange Missing Paragraphs (Part 2)</h1>
  <div id="timer">10:00</div>
</header>

<main>
  <p class="instructions">
    Tap a paragraph in the <strong>Paragraph Bank</strong> to place it into the next blank. Tap <strong>Undo</strong> or remove an item to change your mind before submitting.
  </p>

  <div class="controls">
    <button class="btn secondary" id="undoBtn" type="button" disabled>Undo</button>
    <button class="btn secondary" id="resetBtn" type="button">Start again</button>
    <button class="btn" id="checkBtn" type="button">Check Answers</button>
  </div>

  <div class="columns">
    <div class="column" id="target">
      <h2>Arrange Order</h2>
      <!-- built by JS -->
    </div>

    <div class="column" id="source">
      <h2>Paragraph Bank</h2>
      <!-- built by JS -->
    </div>
  </div>

  <div id="feedback" class="feedback"></div>

  <div class="nav-links">
    <a href="ArrangeParagraphTechTheme.html">Home</a>
    <a href="Part1ArrangeParagraphTechTheme.html">Part 1</a>
    <a href="Part2ArrangeParagraphTechTheme.html">Part 2</a>
    <a href="Part3ArrangeParagraphTechTheme.html">Part 3</a>
  </div>
</main>

<footer>
  © <span>Koala Spies Sydney</span> · Modern English Australia · All Rights Reserved
</footer>

<script>
// ===== Paragraphs (keep pedagogy/text exactly) =====
const paragraphs = [
`Technology has undeniably transformed the way we work—but whether it has made us work less hard is debatable. On the surface, automation and digital tools seem to boost productivity and enhance efficiency. Tasks that once took hours can now be completed in minutes.`,
`In this way communication has become instant, data is centralized, and collaboration spans continents. For instance, Zoom meetings help remote workers work together seamlessly, simultaneously working documents around the world instantly or even designing on platforms. Call centres can operate 24 hours a day and you can buy almost anything you want, anytime online. In short, we can do more, faster and include more people.`,
`These advances augment our capabilities, allowing us to achieve more with fewer resources. Take the development of the COVID vaccine in just a few months, thanks to technology and international collaboration. Imagine what we could do for cancer treatments in the future, not to mention climate solution and space travel.`,
`Yet beneath this apparent ease lies a paradox. The boundaries between work and personal life have deteriorated. Remote access and constant connectivity mean many feel compelled to be “always on,” leading to mental fatigue and burnout.`,
`While physical effort may have declined, cognitive load has increased. The pressure to keep up with rapid technological shifts and constant notifications can be overwhelming.`,
`Moreover, technology often raises expectations. Faster output becomes the norm, not the exception. Instead of freeing us, it sometimes enslaves us to tighter deadlines and higher standards. In this sense, we may be working harder—just differently.`,
`Which has led us to the topic of AI slop that has invaded our social media. AI slop is poor created videos and posts which are kind of convincing but off-putting at the same time because we know they are just imitation of human experiences. Will our favourite musicians and artist one day be replaced by AI?`,
`Ultimately, technology doesn’t guarantee less work; it reshapes the nature of work. Whether that shift is liberating or burdensome depends on how we adapt, set boundaries, and use these tools to serve human needs rather than undermine them.`
];

// ===== Build target with fixed paragraphs + blanks =====
const target = document.getElementById("target");
const source = document.getElementById("source");

let blanks = [];           // DOM refs (in order)
let blankAnswer = [];      // correct answers (strings)
let bank = [];             // bank items (strings)

function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

function build(){
  // clear (keep headings)
  target.querySelectorAll(".paragraph,.blank").forEach(n=>n.remove());
  source.querySelectorAll(".paragraph").forEach(n=>n.remove());

  blanks = [];
  blankAnswer = [];
  bank = [];

  // Arrange pattern stays: even indexes fixed, odd indexes blank
  for(let i=0;i<paragraphs.length;i++){
    if(i%2===0){
      const p = document.createElement("div");
      p.className = "paragraph";
      p.textContent = paragraphs[i];
      target.appendChild(p);
    }else{
      const b = document.createElement("div");
      b.className = "blank";
      b.textContent = "Tap a paragraph to place here";
      b.dataset.answer = paragraphs[i];
      b.dataset.user = "";
      blanks.push(b);
      blankAnswer.push(paragraphs[i]);
      bank.push(paragraphs[i]);
      target.appendChild(b);
    }
  }

  // bank: shuffled
  shuffle(bank).forEach(text=>{
    const p = document.createElement("div");
    p.className = "paragraph";
    p.textContent = text;
    p.dataset.value = text;
    p.setAttribute("role","button");
    p.setAttribute("tabindex","0");
    p.addEventListener("click", () => place(text));
    p.addEventListener("keydown", (e) => { if(e.key==="Enter" || e.key===" ") place(text); });
    source.appendChild(p);
  });

  // reset history
  history.length = 0;
  updateUndo();
  feedback.innerHTML = "";
}

const feedback = document.getElementById("feedback");
const undoBtn = document.getElementById("undoBtn");
const resetBtn = document.getElementById("resetBtn");
const checkBtn = document.getElementById("checkBtn");

// ===== State for undo =====
// each action: { blankIndex, text }
const history = [];

function nextEmptyBlankIndex(){
  return blanks.findIndex(b => !b.dataset.user);
}

function place(text){
  const idx = nextEmptyBlankIndex();
  if(idx === -1) return; // all filled

  // remove from bank
  const bankNode = Array.from(source.querySelectorAll(".paragraph")).find(n => n.dataset.value === text);
  if(!bankNode) return;
  bankNode.remove();

  fillBlank(idx, text, true);
}

function fillBlank(idx, text, pushHistory){
  const b = blanks[idx];
  b.classList.add("filled");
  b.dataset.user = text;

  // content + remove button
  b.innerHTML = "";
  const content = document.createElement("div");
  content.style.whiteSpace = "pre-line";
  content.textContent = text;

  const rm = document.createElement("button");
  rm.type = "button";
  rm.className = "remove";
  rm.textContent = "Remove";
  rm.addEventListener("click", (e) => {
    e.stopPropagation();
    removeFromBlank(idx, true);
  });

  b.appendChild(rm);
  b.appendChild(content);

  if(pushHistory){
    history.push({ blankIndex: idx, text });
    updateUndo();
  }
}

function removeFromBlank(idx, pushHistory){
  const b = blanks[idx];
  const text = b.dataset.user;
  if(!text) return;

  // restore to bank
  addToBank(text);

  // clear blank
  b.classList.remove("filled");
  b.dataset.user = "";
  b.textContent = "Tap a paragraph to place here";

  if(pushHistory){
    history.push({ blankIndex: idx, text: null }); // marker: removal action
    updateUndo();
  }

  feedback.innerHTML = "";
}

function addToBank(text){
  const p = document.createElement("div");
  p.className = "paragraph";
  p.textContent = text;
  p.dataset.value = text;
  p.setAttribute("role","button");
  p.setAttribute("tabindex","0");
  p.addEventListener("click", () => place(text));
  p.addEventListener("keydown", (e) => { if(e.key==="Enter" || e.key===" ") place(text); });
  source.appendChild(p);
}

function updateUndo(){
  // only enable if there is at least one placement we can undo
  // we treat history stack as-is; undo will reverse last placement action
  undoBtn.disabled = history.length === 0;
}

function undo(){
  if(history.length === 0) return;

  // Undo logic:
  // We undo the last *placement* (not the remove marker). If last action is a remove marker,
  // we reverse that (put paragraph back into blank and remove from bank).
  const action = history.pop();

  if(action.text === null){
    // it was a removal action: reverse it
    // find the most recent removed text by looking at previous state is hard, so we store it:
    // But we didn't store it. So instead, we don't push removal markers at all.
    // (We won't reach here; kept for safety.)
    updateUndo();
    return;
  }

  const idx = action.blankIndex;
  const text = action.text;

  // remove from blank
  const b = blanks[idx];
  if(b.dataset.user !== text){
    // if the user changed things, try to locate the last filled blank with that text
    const foundIdx = blanks.findIndex(x => x.dataset.user === text);
    if(foundIdx !== -1){
      undoPlacement(foundIdx, text);
    }else{
      // nothing to undo
      updateUndo();
    }
    return;
  }

  undoPlacement(idx, text);
}

function undoPlacement(idx, text){
  // put it back into bank
  addToBank(text);

  // clear the blank
  const b = blanks[idx];
  b.classList.remove("filled");
  b.dataset.user = "";
  b.textContent = "Tap a paragraph to place here";

  feedback.innerHTML = "";
  updateUndo();
}

// NOTE: Do not push removal markers (keeps undo clean)
function removeFromBlankNoHistory(idx){
  const b = blanks[idx];
  const text = b.dataset.user;
  if(!text) return;
  addToBank(text);
  b.classList.remove("filled");
  b.dataset.user = "";
  b.textContent = "Tap a paragraph to place here";
  feedback.innerHTML = "";
}

// Override remove button behavior to be undoable by pushing a placement-style history
// (better: on remove, push the original placement into history so Undo restores it)
function wireRemoveButtons(){
  // handled inline in fillBlank()
}

// ===== Check Answers =====
function checkAnswers(){
  let score = 0;
  blanks.forEach(b=>{
    const user = (b.dataset.user || "").trim();
    const ans  = (b.dataset.answer || "").trim();
    if(user && user === ans) score++;
  });

  feedback.innerHTML = score === 4
    ? `<span class="correct">Perfect! You scored ${score}/4.</span>`
    : `<span class="incorrect">You scored ${score}/4 correct paragraphs.</span>`;

  localStorage.setItem("PTE_Part2_Score", score);
}

// ===== Reset =====
function startAgain(){
  build();
}

// ===== Events =====
undoBtn.addEventListener("click", undo);
resetBtn.addEventListener("click", startAgain);
checkBtn.addEventListener("click", checkAnswers);

// ===== INIT BUILD =====
build();

// ===== 10-Minute Timer =====
let timeLeft = 10*60;
const timerDisplay = document.getElementById("timer");
const countdown = setInterval(()=>{
  const m = Math.floor(timeLeft/60);
  const s = timeLeft%60;
  timerDisplay.textContent = `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  if(timeLeft<=0){
    clearInterval(countdown);
    timerDisplay.textContent="00:00";
    checkBtn.disabled = true;
    undoBtn.disabled = true;
    resetBtn.disabled = true;
    feedback.innerHTML = `<span class="incorrect">Time’s up!</span>`;
  }
  timeLeft--;
},1000);
</script>
</body>
</html>
